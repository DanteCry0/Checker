const cloudconvert = require('cloudconvert');

// Substitua pela sua chave da API
const apiKey = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiMWFkZDFhZTRmOTJlNTkwY2ExZWI1NzQ2NWE5N2ViYjUyOTI2YmU5YTFlNzVkNmI4YWI4ZjRkODU2ODk5MTYyMDYxNTA2MmU0ODNmMDIzZjgiLCJpYXQiOjE3MzMzNzA1MjkuNDUzMjAxLCJuYmYiOjE3MzMzNzA1MjkuNDUzMjAyLCJleHAiOjQ4ODkwNDQxMjkuNDQ4MzE2LCJzdWIiOiI3MDM5NDM5MiIsInNjb3BlcyI6WyJwcmVzZXQud3JpdGUiLCJ0YXNrLnJlYWQiLCJ0YXNrLndyaXRlIiwid2ViaG9vay5yZWFkIiwid2ViaG9vay53cml0ZSIsInByZXNldC5yZWFkIl19.Mw421UK4qw2iXp_Xv7c1dyuzcsVbuTy0tOFHlhZGBBWbyp5Z6HJn24oU17iiOeRyL51FMOZnW3sQ3v-Ry27z9iuu3hgbwMgkm6PTJalUuthKqlmA7b28wbcsz9U1nVAPdk-BFZJDC6czIY9BjUk_iAlp6LCLtmbC-Q8yusAXTi-3mKF76SMR3NG7IMejvhSBMp__UlACitRjWxT9pT8b00UyjNsoXgS8vmYrQp0rRK43z-7MhqioPjZT6i47ZpBkkXvuWrrvnWVi68g966zkCrd-lpKEJwTLKuys_H4WY-4zIisF2jaQczI8sSzNoSVK4cuvAB_CHY5BtfCjYaJZ8_qdIAPg5IR-U79GKI_z93krAB09VYEwS7pcNm-1ZQiLZ561Ml2jWL5WPiPgo6P8N2ROE2Q26dCUo_5KwRKwvVGvO5cYcp7C9vci8TDpguU2LfaV_SL9IJVBUzTbrL4owCKdszh9g2lgSnXk82e_cKrmJ74Poz1g7J4ivya3y3gr5lcp-_EMT6jv-S0sYLWnwwvkM6phdMZc8EwnQEBdRo9HssIdhfzbZAbb8DArTeT9sOlEj9taOant3IAQnZkVaLyNzhGsBvNlXF656Ru7plG_aw5C3XTh3eVp4OfSprAw7ig9huYxeb6WsKBeUh0Yi_gH5FMK0525jv_BKVzi6gw';
cloudconvert.configure({ apiKey: apiKey });

async function convertFile(inputFilePath, outputFilePath) {
  try {
    const job = await cloudconvert.jobs.create({
      "tasks": {
        "import-1": {
          "operation": "import/upload"
        },
        "convert-1": {
          "operation": "convert",
          "input": "import-1",
          "output_format": "jpg",
          "to": "jpg"
        },
        "export-1": {
          "operation": "export/url",
          "input": "convert-1"
        }
      }
    });

    // Fazer o upload do arquivo
    const uploadTask = await cloudconvert.tasks.upload(job, 'import-1', inputFilePath);

    // Aguarde a conversão
    await cloudconvert.jobs.wait(job.id);

    // Obtenha o arquivo convertido
    const exportTask = job.tasks.find(t => t.name === 'export-1');
    const exportUrl = exportTask.result.files[0].url;

    // Baixar o arquivo convertido
    const response = await fetch(exportUrl);
    const buffer = await response.buffer();

    // Salve o arquivo convertido
    require('fs').writeFileSync(outputFilePath, buffer);
    console.log('Conversão concluída com sucesso!');
  } catch (error) {
    console.error('Erro na conversão:', error);
  }
}

// Chamada de exemplo para converter um arquivo
convertFile('path_to_your_input_file.cdr', 'output_image.jpg');
